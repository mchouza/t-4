A51 MACRO ASSEMBLER  TECSERIE                                                             11/03/2007 15:59:04 PAGE     1


MACRO ASSEMBLER A51 V8.00b
OBJECT MODULE PLACED IN tecserie.OBJ
ASSEMBLER INVOKED BY: C:\Keil3\C51\BIN\A51.EXE tecserie.a SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

  00A0                 1     puerto_teclado_0 EQU P2.0
  00A1                 2     puerto_teclado_1 EQU P2.1
  00A2                 3     puerto_teclado_2 EQU P2.2
  00A3                 4     puerto_teclado_3 EQU P2.3
  00A4                 5     puerto_teclado_4 EQU P2.4
  00A5                 6     puerto_teclado_5 EQU P2.5
  00A6                 7     puerto_teclado_6 EQU P2.6
  00A7                 8     puerto_teclado_7 EQU P2.7
                       9     
----                  10     dseg at 0x20
0020                  11                     tecla_byte_1: ds 1
----                  12     dseg at 0x28
0028                  13                     tecla_byte_2: ds 1
                      14     
----                  15     cseg
                      16     
                      17     ;1 ciclo de maquina lleva (1/33 Mhz) * 12 = aprox. 0.3 us
                      18     ;255 movs serían aprox. 80 us
                      19     ;200*255 movs serían aprox 16 ms
0000 7520FF           20                     mov tecla_byte_1, #0xff ;Ninguna apretada inicialmente
0003 7528FF           21                     mov tecla_byte_2, #0xff ;Ninguna apretada inicialmente
                      22     
0006 D2A0             23                     setb puerto_teclado_0 ;Pin para lectura
0008 D2A1             24                     setb puerto_teclado_1 ;Pin para lectura
000A D2A2             25                     setb puerto_teclado_2 ;Pin para lectura
000C D2A3             26                     setb puerto_teclado_3 ;Pin para lectura
                      27     
                      28                     ;Habilito el puerto serie con SCON. Modo 2 (Asincrónico 10 bits)
000E D29F             29                     setb SM0 ;SM0=1
0010 C29E             30                     clr SM1 ;SM0=0
                      31     
0012 78C8             32     inicio: mov R0, #200
0014 79FF             33     mas:    mov R1, #255
0016 D9FE             34                     djnz R1,$
0018 D8FA             35                     djnz R0, mas
001A 111E             36                     call revisar_teclado
001C 80F4             37                 jmp inicio
                      38     
001E                  39     revisar_teclado:
001E C2A4             40                     clr puerto_teclado_4 ;Exploro primera columna
                      41                     
0020 20A00B           42                     jb puerto_teclado_0, suelta_0
0023 30070A           43                     jnb tecla_byte_1.7, sig_0 ;Se presiono tecla(1,1). Si antes estaba suelta
0026 AA41             44                     mov R2, 'A'
0028 C207             45                     clr tecla_byte_1.7 ;Marco que ahora esta presionada
002A 1141             46                     call enviar_tecla
002C 8002             47                     jmp sig_0
002E                  48     suelta_0:
002E D207             49                     setb tecla_byte_1.7 ;Marco que ahora esta suelta                        
0030                  50     sig_0:
                      51     
                      52     
0030 20A10B           53                     jb puerto_teclado_1, suelta_1
0033 30060A           54                     jnb tecla_byte_1.6, sig_1 ;Se presiono tecla(1,1). Si antes estaba suelta
0036 AA42             55                     mov R2, 'B'
0038 C206             56                     clr tecla_byte_1.6 ;Marco que ahora esta presionada
003A 1141             57                     call enviar_tecla
003C 8002             58                     jmp sig_1
A51 MACRO ASSEMBLER  TECSERIE                                                             11/03/2007 15:59:04 PAGE     2

003E                  59     suelta_1:
003E D206             60                     setb tecla_byte_1.6 ;Marco que ahora esta suelta                        
0040                  61     sig_1:
                      62     
                      63     
0040 22               64                     ret
                      65     
0041                  66     enviar_tecla:
0041 C299             67                     clr TI ;Cuando el micro termina la transmisión, avisará seteando TI
0043 8A99             68                     mov SBUF, R2
0045 22               69                     ret
                      70     
                      71     end
A51 MACRO ASSEMBLER  TECSERIE                                                             11/03/2007 15:59:04 PAGE     3

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

ENVIAR_TECLA . . .  C ADDR   0041H   A   
INICIO . . . . . .  C ADDR   0012H   A   
MAS. . . . . . . .  C ADDR   0014H   A   
P2 . . . . . . . .  D ADDR   00A0H   A   
PUERTO_TECLADO_0 .  B ADDR   00A0H.0 A   
PUERTO_TECLADO_1 .  B ADDR   00A0H.1 A   
PUERTO_TECLADO_2 .  B ADDR   00A0H.2 A   
PUERTO_TECLADO_3 .  B ADDR   00A0H.3 A   
PUERTO_TECLADO_4 .  B ADDR   00A0H.4 A   
PUERTO_TECLADO_5 .  B ADDR   00A0H.5 A   
PUERTO_TECLADO_6 .  B ADDR   00A0H.6 A   
PUERTO_TECLADO_7 .  B ADDR   00A0H.7 A   
REVISAR_TECLADO. .  C ADDR   001EH   A   
SBUF . . . . . . .  D ADDR   0099H   A   
SIG_0. . . . . . .  C ADDR   0030H   A   
SIG_1. . . . . . .  C ADDR   0040H   A   
SM0. . . . . . . .  B ADDR   0098H.7 A   
SM1. . . . . . . .  B ADDR   0098H.6 A   
SUELTA_0 . . . . .  C ADDR   002EH   A   
SUELTA_1 . . . . .  C ADDR   003EH   A   
TECLA_BYTE_1 . . .  D ADDR   0020H   A   
TECLA_BYTE_2 . . .  D ADDR   0028H   A   
TI . . . . . . . .  B ADDR   0098H.1 A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
