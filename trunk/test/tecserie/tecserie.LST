A51 MACRO ASSEMBLER  TECSERIE                                                             11/05/2007 18:06:50 PAGE     1


MACRO ASSEMBLER A51 V8.00b
OBJECT MODULE PLACED IN tecserie.OBJ
ASSEMBLER INVOKED BY: C:\Keil3\C51\BIN\A51.EXE tecserie.a SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

  00A0                 1     puerto_teclado_0 EQU P2.0
  00A1                 2     puerto_teclado_1 EQU P2.1
  00A2                 3     puerto_teclado_2 EQU P2.2
  00A3                 4     puerto_teclado_3 EQU P2.3
  00A4                 5     puerto_teclado_4 EQU P2.4
  00A5                 6     puerto_teclado_5 EQU P2.5
  00A6                 7     puerto_teclado_6 EQU P2.6
  00A7                 8     puerto_teclado_7 EQU P2.7
                       9     
----                  10     dseg at 0x20
0020                  11                     tecla_byte_1: ds 1
----                  12     dseg at 0x28
0028                  13                     tecla_byte_2: ds 1
                      14     
----                  15     cseg
                      16     
                      17     ;1 ciclo de maquina lleva (1/33 Mhz) * 12 = aprox. 0.3 us
                      18     ;255 movs serían aprox. 80 us
                      19     ;200*255 movs serían aprox 16 ms
0000 7520FF           20                     mov tecla_byte_1, #0xff ;Ninguna apretada inicialmente
0003 7528FF           21                     mov tecla_byte_2, #0xff ;Ninguna apretada inicialmente
                      22     
0006 D2A0             23                     setb puerto_teclado_0 ;Pin para lectura
0008 D2A1             24                     setb puerto_teclado_1 ;Pin para lectura
000A D2A2             25                     setb puerto_teclado_2 ;Pin para lectura
000C D2A3             26                     setb puerto_teclado_3 ;Pin para lectura
                      27     
                      28                     ;Habilito el puerto serie con SCON. Modo 2 (Asincrónico 10 bits)
000E D29F             29                     setb SM0 ;SM0=1
0010 C29E             30                     clr SM1 ;SM0=0
0012 D299             31                     setb TI
0014 7A41             32                     mov R2, #'A'
                      33     
0016 780A             34     inicio: mov R0, #10
0018 79FF             35     mas:    mov R1, #255
001A D9FE             36                     djnz R1,$
001C D8FA             37                     djnz R0, mas
                      38     
001E 1122             39                     call revisar_teclado
0020 80F4             40                 jmp inicio
                      41     
0022                  42     revisar_teclado:
0022 C2A4             43                     clr puerto_teclado_4 ;Exploro primera columna
                      44                     
0024 20A006           45                     jb puerto_teclado_0, suelta_0
0027 7A41             46                     mov R2, #'A'
0029 1137             47                     call enviar_tecla
002B 8000             48                     jmp sig_0
002D                  49     suelta_0:
                      50                             
002D                  51     sig_0:
                      52     
                      53     
002D 20A106           54                     jb puerto_teclado_1, suelta_1
0030 7A42             55                     mov R2, #'B'
0032 1137             56                     call enviar_tecla
0034 8000             57                     jmp sig_1
0036                  58     suelta_1:
A51 MACRO ASSEMBLER  TECSERIE                                                             11/05/2007 18:06:50 PAGE     2

                      59                             
0036                  60     sig_1:
                      61     
                      62     
0036 22               63                     ret
                      64     
0037                  65     enviar_tecla:
0037 3099FD           66                     jnb TI, $ ;Cuando el micro termina la transmisión, avisará seteando TI
003A C299             67                     clr TI 
003C 8A99             68                     mov SBUF, R2
003E 22               69                     ret
                      70     
                      71     end
A51 MACRO ASSEMBLER  TECSERIE                                                             11/05/2007 18:06:50 PAGE     3

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

ENVIAR_TECLA . . .  C ADDR   0037H   A   
INICIO . . . . . .  C ADDR   0016H   A   
MAS. . . . . . . .  C ADDR   0018H   A   
P2 . . . . . . . .  D ADDR   00A0H   A   
PUERTO_TECLADO_0 .  B ADDR   00A0H.0 A   
PUERTO_TECLADO_1 .  B ADDR   00A0H.1 A   
PUERTO_TECLADO_2 .  B ADDR   00A0H.2 A   
PUERTO_TECLADO_3 .  B ADDR   00A0H.3 A   
PUERTO_TECLADO_4 .  B ADDR   00A0H.4 A   
PUERTO_TECLADO_5 .  B ADDR   00A0H.5 A   
PUERTO_TECLADO_6 .  B ADDR   00A0H.6 A   
PUERTO_TECLADO_7 .  B ADDR   00A0H.7 A   
REVISAR_TECLADO. .  C ADDR   0022H   A   
SBUF . . . . . . .  D ADDR   0099H   A   
SIG_0. . . . . . .  C ADDR   002DH   A   
SIG_1. . . . . . .  C ADDR   0036H   A   
SM0. . . . . . . .  B ADDR   0098H.7 A   
SM1. . . . . . . .  B ADDR   0098H.6 A   
SUELTA_0 . . . . .  C ADDR   002DH   A   
SUELTA_1 . . . . .  C ADDR   0036H   A   
TECLA_BYTE_1 . . .  D ADDR   0020H   A   
TECLA_BYTE_2 . . .  D ADDR   0028H   A   
TI . . . . . . . .  B ADDR   0098H.1 A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
