puerto_teclado_0 EQU P1.0
puerto_teclado_1 EQU P1.1
puerto_teclado_2 EQU P1.2
puerto_teclado_3 EQU P1.3
puerto_teclado_4 EQU P1.4
puerto_teclado_5 EQU P1.5
puerto_teclado_6 EQU P1.6
puerto_teclado_7 EQU P1.7

dseg at 0x20
		tecla_byte_1: ds 1
dseg at 0x28
		tecla_byte_2: ds 1

cseg

;1 ciclo de maquina lleva (1/33 Mhz) * 12 = aprox. 0.3 us
;255 movs serían aprox. 80 us
;200*255 movs serían aprox 16 ms
		mov tecla_byte_1, #0xff ;Ninguna apretada inicialmente
		mov tecla_byte_2, #0xff ;Ninguna apretada inicialmente

		setb puerto_teclado_0 ;Pin para lectura
		setb puerto_teclado_1 ;Pin para lectura
		setb puerto_teclado_2 ;Pin para lectura
		setb puerto_teclado_3 ;Pin para lectura

		;Habilito el puerto serie con SCON. Modo 2 (Asincrónico 10 bits)
		setb SM0 ;SM0=1
		clr SM1 ;SM0=0

inicio:	mov R0, #200
mas:	mov R1, #255
		djnz R1,$
		djnz R0, mas
		call revisar_teclado
	    jmp inicio

revisar_teclado:
		clr puerto_teclado_4 ;Exploro primera columna
		
		jb puerto_teclado_0, suelta_0
		jnb tecla_byte_1.7, sig_0 ;Se presiono tecla(1,1). Si antes estaba suelta
		mov R2, 'A'
		clr tecla_byte_1.7 ;Marco que ahora esta presionada
		call enviar_tecla
		jmp sig_0
suelta_0:
		setb tecla_byte_1.7 ;Marco que ahora esta suelta			
sig_0:


		jb puerto_teclado_1, suelta_1
		jnb tecla_byte_1.6, sig_1 ;Se presiono tecla(1,1). Si antes estaba suelta
		mov R2, 'B'
		clr tecla_byte_1.6 ;Marco que ahora esta presionada
		call enviar_tecla
		jmp sig_1
suelta_1:
		setb tecla_byte_1.6 ;Marco que ahora esta suelta			
sig_1:


		ret

enviar_tecla:
		setb REN
		clr TI ;Cuando el micro termina la transmisión, avisará seteando TI
		mov SBUF, R2
		ret

end